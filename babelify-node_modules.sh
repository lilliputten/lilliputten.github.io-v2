#!/bin/sh
# @desc Process ES6 dependencies
# @see Incident log: `!Work/210818-build-error/error.log`
# TODO: Include to postinstall
# @since 2021.08.18, 21:52
# @changed 2021.08.18, 22:15

# Run it in case of next errors:
# ```
# Failed to minify the code from this file:
# ./node_modules/lowlight/node_modules/highlight.js/lib/core.js:32
# ```
# TODO: May be include as patch?

processFile() {
  echo "Processing: $1 ..."
  ORIG="$1.orig"
  if [ -f "$ORIG" ]; then
    echo "File already transpilled"
  else
    cp "$1" "$ORIG" \
    && node_modules/.bin/babel --presets=babel-preset-es2015 \
      "$ORIG" > "$1" \
    && echo "OK: $1"
  fi
}

WORKPATH="node_modules/lowlight/node_modules/highlight.js"

echo "Processing files..." \
  && processFile "$WORKPATH/lib/core.js" \
  && echo "All files processed"

